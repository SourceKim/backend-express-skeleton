{
    "info": {
        "name": "Permission",
        "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
    },
    "item": [
        {
            "name": "创建权限",
            "event": [
                {
                    "listen": "test",
                    "script": {
                        "exec": [
                            "pm.test('状态码为 200', function() {",
                            "    pm.response.to.have.status(200);",
                            "});",
                            "",
                            "pm.test('返回正确的数据结构', function() {",
                            "    const jsonData = pm.response.json();",
                            "    pm.expect(jsonData.code).to.equal(0);",
                            "    pm.expect(jsonData.data).to.have.property('id');",
                            "    pm.expect(jsonData.data).to.have.property('name');",
                            "    pm.expect(jsonData.data).to.have.property('resource');",
                            "    pm.expect(jsonData.data).to.have.property('action');",
                            "});",
                            "",
                            "pm.test('权限名称正确', function() {",
                            "    const jsonData = pm.response.json();",
                            "    pm.expect(jsonData.data.resource).to.equal(pm.environment.get('permissionResource'));",
                            "    pm.expect(jsonData.data.action).to.equal(pm.environment.get('permissionAction'));",
                            "});",
                            "",
                            "if (pm.response.code === 200) {",
                            "    pm.environment.set('permissionId', pm.response.json().data.id);",
                            "}"
                        ]
                    }
                }
            ],
            "request": {
                "method": "POST",
                "header": [
                    {
                        "key": "Content-Type",
                        "value": "application/json"
                    },
                    {
                        "key": "Authorization",
                        "value": "Bearer {{token}}"
                    }
                ],
                "body": {
                    "mode": "raw",
                    "raw": "{\n    \"resource\": \"{{permissionResource}}\",\n    \"action\": \"{{permissionAction}}\",\n    \"description\": \"测试权限\"\n}"
                },
                "url": {
                    "raw": "{{baseUrl}}/permissions",
                    "host": ["{{baseUrl}}"],
                    "path": ["permissions"]
                }
            }
        },
        {
            "name": "获取权限列表",
            "event": [
                {
                    "listen": "test",
                    "script": {
                        "exec": [
                            "pm.test('状态码为 200', function() {",
                            "    pm.response.to.have.status(200);",
                            "});",
                            "",
                            "pm.test('返回正确的数据结构', function() {",
                            "    const jsonData = pm.response.json();",
                            "    pm.expect(jsonData.code).to.equal(0);",
                            "    pm.expect(jsonData.data).to.be.an('array');",
                            "    if (jsonData.data.length > 0) {",
                            "        pm.expect(jsonData.data[0]).to.have.property('id');",
                            "        pm.expect(jsonData.data[0]).to.have.property('name');",
                            "        pm.expect(jsonData.data[0]).to.have.property('resource');",
                            "        pm.expect(jsonData.data[0]).to.have.property('action');",
                            "    }",
                            "});"
                        ]
                    }
                }
            ],
            "request": {
                "method": "GET",
                "header": [
                    {
                        "key": "Authorization",
                        "value": "Bearer {{token}}"
                    }
                ],
                "url": {
                    "raw": "{{baseUrl}}/permissions",
                    "host": ["{{baseUrl}}"],
                    "path": ["permissions"]
                }
            }
        },
        {
            "name": "获取单个权限",
            "event": [
                {
                    "listen": "test",
                    "script": {
                        "exec": [
                            "pm.test('状态码为 200', function() {",
                            "    pm.response.to.have.status(200);",
                            "});",
                            "",
                            "pm.test('返回正确的数据结构', function() {",
                            "    const jsonData = pm.response.json();",
                            "    pm.expect(jsonData.code).to.equal(0);",
                            "    pm.expect(jsonData.data).to.have.property('id');",
                            "    pm.expect(jsonData.data).to.have.property('name');",
                            "    pm.expect(jsonData.data).to.have.property('resource');",
                            "    pm.expect(jsonData.data).to.have.property('action');",
                            "});",
                            "",
                            "pm.test('返回的权限ID正确', function() {",
                            "    const jsonData = pm.response.json();",
                            "    pm.expect(jsonData.data.id).to.equal(pm.environment.get('permissionId'));",
                            "});"
                        ]
                    }
                }
            ],
            "request": {
                "method": "GET",
                "header": [
                    {
                        "key": "Authorization",
                        "value": "Bearer {{token}}"
                    }
                ],
                "url": {
                    "raw": "{{baseUrl}}/permissions/{{permissionId}}",
                    "host": ["{{baseUrl}}"],
                    "path": ["permissions", "{{permissionId}}"]
                }
            }
        },
        {
            "name": "更新权限",
            "event": [
                {
                    "listen": "test",
                    "script": {
                        "exec": [
                            "pm.test('状态码为 200', function() {",
                            "    pm.response.to.have.status(200);",
                            "});",
                            "",
                            "pm.test('返回正确的数据结构', function() {",
                            "    const jsonData = pm.response.json();",
                            "    pm.expect(jsonData.code).to.equal(0);",
                            "    pm.expect(jsonData.data).to.have.property('id');",
                            "    pm.expect(jsonData.data).to.have.property('name');",
                            "    pm.expect(jsonData.data).to.have.property('description');",
                            "});",
                            "",
                            "pm.test('权限描述已更新', function() {",
                            "    const jsonData = pm.response.json();",
                            "    pm.expect(jsonData.data.description).to.equal('更新后的测试权限描述');",
                            "});"
                        ]
                    }
                }
            ],
            "request": {
                "method": "PUT",
                "header": [
                    {
                        "key": "Content-Type",
                        "value": "application/json"
                    },
                    {
                        "key": "Authorization",
                        "value": "Bearer {{token}}"
                    }
                ],
                "body": {
                    "mode": "raw",
                    "raw": "{\n    \"description\": \"更新后的测试权限描述\"\n}"
                },
                "url": {
                    "raw": "{{baseUrl}}/permissions/{{permissionId}}",
                    "host": ["{{baseUrl}}"],
                    "path": ["permissions", "{{permissionId}}"]
                }
            }
        },
        {
            "name": "创建角色",
            "event": [
                {
                    "listen": "test",
                    "script": {
                        "exec": [
                            "pm.test('状态码为 200', function() {",
                            "    pm.response.to.have.status(200);",
                            "});",
                            "",
                            "pm.test('返回正确的数据结构', function() {",
                            "    const jsonData = pm.response.json();",
                            "    pm.expect(jsonData.code).to.equal(0);",
                            "    pm.expect(jsonData.data).to.have.property('id');",
                            "    pm.expect(jsonData.data).to.have.property('name');",
                            "    pm.expect(jsonData.data).to.have.property('permissions').that.is.an('array');",
                            "});",
                            "",
                            "pm.test('角色名称正确', function() {",
                            "    const jsonData = pm.response.json();",
                            "    pm.expect(jsonData.data.name).to.equal(pm.environment.get('roleName'));",
                            "});",
                            "",
                            "if (pm.response.code === 200) {",
                            "    pm.environment.set('roleId', pm.response.json().data.id);",
                            "}"
                        ]
                    }
                }
            ],
            "request": {
                "method": "POST",
                "header": [
                    {
                        "key": "Content-Type",
                        "value": "application/json"
                    },
                    {
                        "key": "Authorization",
                        "value": "Bearer {{token}}"
                    }
                ],
                "body": {
                    "mode": "raw",
                    "raw": "{\n    \"name\": \"{{roleName}}\",\n    \"description\": \"测试角色\"\n}"
                },
                "url": {
                    "raw": "{{baseUrl}}/permissions/roles",
                    "host": ["{{baseUrl}}"],
                    "path": ["permissions", "roles"]
                }
            }
        },
        {
            "name": "获取角色列表",
            "event": [
                {
                    "listen": "test",
                    "script": {
                        "exec": [
                            "pm.test('状态码为 200', function() {",
                            "    pm.response.to.have.status(200);",
                            "});",
                            "",
                            "pm.test('返回正确的数据结构', function() {",
                            "    const jsonData = pm.response.json();",
                            "    pm.expect(jsonData.code).to.equal(0);",
                            "    pm.expect(jsonData.data).to.be.an('array');",
                            "    if (jsonData.data.length > 0) {",
                            "        pm.expect(jsonData.data[0]).to.have.property('id');",
                            "        pm.expect(jsonData.data[0]).to.have.property('name');",
                            "        pm.expect(jsonData.data[0]).to.have.property('permissions').that.is.an('array');",
                            "    }",
                            "});"
                        ]
                    }
                }
            ],
            "request": {
                "method": "GET",
                "header": [
                    {
                        "key": "Authorization",
                        "value": "Bearer {{token}}"
                    }
                ],
                "url": {
                    "raw": "{{baseUrl}}/permissions/roles",
                    "host": ["{{baseUrl}}"],
                    "path": ["permissions", "roles"]
                }
            }
        },
        {
            "name": "获取单个角色",
            "event": [
                {
                    "listen": "test",
                    "script": {
                        "exec": [
                            "pm.test('状态码为 200', function() {",
                            "    pm.response.to.have.status(200);",
                            "});",
                            "",
                            "pm.test('返回正确的数据结构', function() {",
                            "    const jsonData = pm.response.json();",
                            "    pm.expect(jsonData.code).to.equal(0);",
                            "    pm.expect(jsonData.data).to.have.property('id');",
                            "    pm.expect(jsonData.data).to.have.property('name');",
                            "    pm.expect(jsonData.data).to.have.property('permissions').that.is.an('array');",
                            "});",
                            "",
                            "pm.test('返回的角色ID正确', function() {",
                            "    const jsonData = pm.response.json();",
                            "    pm.expect(jsonData.data.id).to.equal(pm.environment.get('roleId'));",
                            "});"
                        ]
                    }
                }
            ],
            "request": {
                "method": "GET",
                "header": [
                    {
                        "key": "Authorization",
                        "value": "Bearer {{token}}"
                    }
                ],
                "url": {
                    "raw": "{{baseUrl}}/permissions/roles/{{roleId}}",
                    "host": ["{{baseUrl}}"],
                    "path": ["permissions", "roles", "{{roleId}}"]
                }
            }
        },
        {
            "name": "更新角色",
            "event": [
                {
                    "listen": "test",
                    "script": {
                        "exec": [
                            "pm.test('状态码为 200', function() {",
                            "    pm.response.to.have.status(200);",
                            "});",
                            "",
                            "pm.test('返回正确的数据结构', function() {",
                            "    const jsonData = pm.response.json();",
                            "    pm.expect(jsonData.code).to.equal(0);",
                            "    pm.expect(jsonData.data).to.have.property('id');",
                            "    pm.expect(jsonData.data).to.have.property('name');",
                            "    pm.expect(jsonData.data).to.have.property('description');",
                            "});",
                            "",
                            "pm.test('角色描述已更新', function() {",
                            "    const jsonData = pm.response.json();",
                            "    pm.expect(jsonData.data.description).to.equal('更新后的测试角色描述');",
                            "});"
                        ]
                    }
                }
            ],
            "request": {
                "method": "PUT",
                "header": [
                    {
                        "key": "Content-Type",
                        "value": "application/json"
                    },
                    {
                        "key": "Authorization",
                        "value": "Bearer {{token}}"
                    }
                ],
                "body": {
                    "mode": "raw",
                    "raw": "{\n    \"description\": \"更新后的测试角色描述\"\n}"
                },
                "url": {
                    "raw": "{{baseUrl}}/permissions/roles/{{roleId}}",
                    "host": ["{{baseUrl}}"],
                    "path": ["permissions", "roles", "{{roleId}}"]
                }
            }
        },
        {
            "name": "为角色分配权限",
            "event": [
                {
                    "listen": "test",
                    "script": {
                        "exec": [
                            "pm.test('状态码为 200', function() {",
                            "    pm.response.to.have.status(200);",
                            "});",
                            "",
                            "pm.test('返回正确的数据结构', function() {",
                            "    const jsonData = pm.response.json();",
                            "    pm.expect(jsonData.code).to.equal(0);",
                            "    pm.expect(jsonData.data).to.have.property('id');",
                            "    pm.expect(jsonData.data).to.have.property('permissions').that.is.an('array');",
                            "});",
                            "",
                            "pm.test('权限已成功分配', function() {",
                            "    const jsonData = pm.response.json();",
                            "    const hasPermission = jsonData.data.permissions.some(p => p.id === pm.environment.get('permissionId'));",
                            "    pm.expect(hasPermission).to.be.true;",
                            "});"
                        ]
                    }
                }
            ],
            "request": {
                "method": "POST",
                "header": [
                    {
                        "key": "Content-Type",
                        "value": "application/json"
                    },
                    {
                        "key": "Authorization",
                        "value": "Bearer {{token}}"
                    }
                ],
                "body": {
                    "mode": "raw",
                    "raw": "{\n    \"permissions\": [\"{{permissionId}}\"]\n}"
                },
                "url": {
                    "raw": "{{baseUrl}}/permissions/roles/{{roleId}}/permissions",
                    "host": ["{{baseUrl}}"],
                    "path": ["permissions", "roles", "{{roleId}}", "permissions"]
                }
            }
        },
        {
            "name": "为用户分配角色",
            "event": [
                {
                    "listen": "test",
                    "script": {
                        "exec": [
                            "pm.test('状态码为 200', function() {",
                            "    pm.response.to.have.status(200);",
                            "});",
                            "",
                            "pm.test('返回正确的数据结构', function() {",
                            "    const jsonData = pm.response.json();",
                            "    pm.expect(jsonData.code).to.equal(0);",
                            "    pm.expect(jsonData.data).to.have.property('id');",
                            "    pm.expect(jsonData.data).to.have.property('roles').that.is.an('array');",
                            "});",
                            "",
                            "pm.test('角色已成功分配', function() {",
                            "    const jsonData = pm.response.json();",
                            "    const hasRole = jsonData.data.roles.some(r => r.id === pm.environment.get('roleId'));",
                            "    pm.expect(hasRole).to.be.true;",
                            "});"
                        ]
                    }
                }
            ],
            "request": {
                "method": "POST",
                "header": [
                    {
                        "key": "Content-Type",
                        "value": "application/json"
                    },
                    {
                        "key": "Authorization",
                        "value": "Bearer {{token}}"
                    }
                ],
                "body": {
                    "mode": "raw",
                    "raw": "{\n    \"roles\": [\"{{roleId}}\"]\n}"
                },
                "url": {
                    "raw": "{{baseUrl}}/permissions/users/{{userId}}/roles",
                    "host": ["{{baseUrl}}"],
                    "path": ["permissions", "users", "{{userId}}", "roles"]
                }
            }
        },
        {
            "name": "删除角色",
            "event": [
                {
                    "listen": "test",
                    "script": {
                        "exec": [
                            "pm.test('状态码为 200', function() {",
                            "    pm.response.to.have.status(200);",
                            "});",
                            "",
                            "pm.test('返回正确的数据结构', function() {",
                            "    const jsonData = pm.response.json();",
                            "    pm.expect(jsonData.code).to.equal(0);",
                            "});"
                        ]
                    }
                }
            ],
            "request": {
                "method": "DELETE",
                "header": [
                    {
                        "key": "Authorization",
                        "value": "Bearer {{token}}"
                    }
                ],
                "url": {
                    "raw": "{{baseUrl}}/permissions/roles/{{roleId}}",
                    "host": ["{{baseUrl}}"],
                    "path": ["permissions", "roles", "{{roleId}}"]
                }
            }
        },
        {
            "name": "删除权限",
            "event": [
                {
                    "listen": "test",
                    "script": {
                        "exec": [
                            "pm.test('状态码为 200', function() {",
                            "    pm.response.to.have.status(200);",
                            "});",
                            "",
                            "pm.test('返回正确的数据结构', function() {",
                            "    const jsonData = pm.response.json();",
                            "    pm.expect(jsonData.code).to.equal(0);",
                            "});"
                        ]
                    }
                }
            ],
            "request": {
                "method": "DELETE",
                "header": [
                    {
                        "key": "Authorization",
                        "value": "Bearer {{token}}"
                    }
                ],
                "url": {
                    "raw": "{{baseUrl}}/permissions/{{permissionId}}",
                    "host": ["{{baseUrl}}"],
                    "path": ["permissions", "{{permissionId}}"]
                }
            }
        }
    ]
} 