{
    "info": {
        "name": "AskBudda - Sutra",
        "description": "佛经模块的 API 测试集合",
        "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
    },
    "item": [
        {
            "name": "获取佛经列表",
            "request": {
                "method": "GET",
                "url": {
                    "raw": "{{baseUrl}}/sutras?page=1&limit=10",
                    "host": ["{{baseUrl}}"],
                    "path": ["sutras"],
                    "query": [
                        {
                            "key": "page",
                            "value": "1"
                        },
                        {
                            "key": "limit",
                            "value": "10"
                        },
                        {
                            "key": "category",
                            "value": "般若部",
                            "disabled": true
                        },
                        {
                            "key": "keyword",
                            "value": "金刚经",
                            "disabled": true
                        }
                    ]
                }
            },
            "event": [
                {
                    "listen": "test",
                    "script": {
                        "type": "text/javascript",
                        "exec": [
                            "pm.test(\"获取佛经列表成功状态码是 200\", function () {",
                            "    pm.response.to.have.status(200);",
                            "});",
                            "",
                            "pm.test(\"响应包含正确的数据结构\", function () {",
                            "    const responseData = pm.response.json();",
                            "    pm.expect(responseData.code).to.equal(0);",
                            "    pm.expect(responseData.data).to.have.property('total');",
                            "    pm.expect(responseData.data).to.have.property('items');",
                            "    pm.expect(responseData.data.items).to.be.an('array');",
                            "});",
                            "",
                            "pm.test(\"佛经列表项包含所需字段\", function () {",
                            "    const responseData = pm.response.json();",
                            "    if (responseData.data.items.length > 0) {",
                            "        const firstItem = responseData.data.items[0];",
                            "        pm.expect(firstItem).to.have.property('id');",
                            "        pm.expect(firstItem).to.have.property('title');",
                            "        pm.expect(firstItem).to.have.property('category');",
                            "        pm.expect(firstItem).to.have.property('content');",
                            "        pm.expect(firstItem).to.have.property('read_count');",
                            "",
                            "        // 保存第一个佛经的 ID 用于后续测试",
                            "        pm.environment.set('sutraId', firstItem.id);",
                            "    }",
                            "});"
                        ]
                    }
                }
            ]
        },
        {
            "name": "获取佛经详情",
            "request": {
                "method": "GET",
                "url": {
                    "raw": "{{baseUrl}}/sutras/{{sutraId}}",
                    "host": ["{{baseUrl}}"],
                    "path": ["sutras", "{{sutraId}}"]
                }
            },
            "event": [
                {
                    "listen": "test",
                    "script": {
                        "type": "text/javascript",
                        "exec": [
                            "pm.test(\"获取佛经详情成功状态码是 200\", function () {",
                            "    pm.response.to.have.status(200);",
                            "});",
                            "",
                            "pm.test(\"佛经详情包含完整信息\", function () {",
                            "    const responseData = pm.response.json();",
                            "    pm.expect(responseData.code).to.equal(0);",
                            "    pm.expect(responseData.data).to.have.property('id');",
                            "    pm.expect(responseData.data).to.have.property('title');",
                            "    pm.expect(responseData.data).to.have.property('category');",
                            "    pm.expect(responseData.data).to.have.property('content');",
                            "    pm.expect(responseData.data).to.have.property('read_count');",
                            "    pm.expect(responseData.data).to.have.property('created_at');",
                            "    pm.expect(responseData.data).to.have.property('updated_at');",
                            "});"
                        ]
                    }
                }
            ]
        },
        {
            "name": "创建佛经",
            "request": {
                "method": "POST",
                "header": [
                    {
                        "key": "Authorization",
                        "value": "Bearer {{token}}"
                    },
                    {
                        "key": "Content-Type",
                        "value": "application/json"
                    }
                ],
                "url": {
                    "raw": "{{baseUrl}}/sutras",
                    "host": ["{{baseUrl}}"],
                    "path": ["sutras"]
                },
                "body": {
                    "mode": "raw",
                    "raw": "{\n    \"title\": \"测试佛经\",\n    \"category\": \"测试分类\",\n    \"description\": \"这是一部测试用的佛经\",\n    \"content\": \"佛经内容...\"\n}"
                }
            },
            "event": [
                {
                    "listen": "test",
                    "script": {
                        "type": "text/javascript",
                        "exec": [
                            "pm.test(\"创建佛经成功状态码是 200\", function () {",
                            "    pm.response.to.have.status(200);",
                            "});",
                            "",
                            "pm.test(\"创建的佛经包含所需字段\", function () {",
                            "    const responseData = pm.response.json();",
                            "    pm.expect(responseData.code).to.equal(0);",
                            "    pm.expect(responseData.data).to.have.property('id');",
                            "    pm.expect(responseData.data).to.have.property('title');",
                            "    pm.expect(responseData.data).to.have.property('category');",
                            "    pm.expect(responseData.data).to.have.property('description');",
                            "    pm.expect(responseData.data).to.have.property('content');",
                            "    pm.expect(responseData.data).to.have.property('created_at');",
                            "",
                            "    // 保存创建的佛经 ID 用于后续测试",
                            "    if (responseData.data.id) {",
                            "        pm.environment.set('sutraId', responseData.data.id);",
                            "    }",
                            "});"
                        ]
                    }
                }
            ]
        },
        {
            "name": "更新佛经",
            "request": {
                "method": "PUT",
                "header": [
                    {
                        "key": "Authorization",
                        "value": "Bearer {{token}}"
                    },
                    {
                        "key": "Content-Type",
                        "value": "application/json"
                    }
                ],
                "url": {
                    "raw": "{{baseUrl}}/sutras/{{sutraId}}",
                    "host": ["{{baseUrl}}"],
                    "path": ["sutras", "{{sutraId}}"]
                },
                "body": {
                    "mode": "raw",
                    "raw": "{\n    \"title\": \"更新后的佛经\",\n    \"description\": \"更新后的描述\"\n}"
                }
            },
            "event": [
                {
                    "listen": "test",
                    "script": {
                        "type": "text/javascript",
                        "exec": [
                            "pm.test(\"更新佛经成功状态码是 200\", function () {",
                            "    pm.response.to.have.status(200);",
                            "});",
                            "",
                            "pm.test(\"更新后的佛经包含更新的字段\", function () {",
                            "    const responseData = pm.response.json();",
                            "    pm.expect(responseData.code).to.equal(0);",
                            "    pm.expect(responseData.data).to.have.property('id');",
                            "    pm.expect(responseData.data.title).to.equal('更新后的佛经');",
                            "    pm.expect(responseData.data.description).to.equal('更新后的描述');",
                            "    pm.expect(responseData.data).to.have.property('updated_at');",
                            "});"
                        ]
                    }
                }
            ]
        },
        {
            "name": "删除佛经",
            "request": {
                "method": "DELETE",
                "header": [
                    {
                        "key": "Authorization",
                        "value": "Bearer {{token}}"
                    }
                ],
                "url": {
                    "raw": "{{baseUrl}}/sutras/{{sutraId}}",
                    "host": ["{{baseUrl}}"],
                    "path": ["sutras", "{{sutraId}}"]
                }
            },
            "event": [
                {
                    "listen": "test",
                    "script": {
                        "type": "text/javascript",
                        "exec": [
                            "pm.test(\"删除佛经成功状态码是 200\", function () {",
                            "    pm.response.to.have.status(200);",
                            "});",
                            "",
                            "pm.test(\"删除响应正确\", function () {",
                            "    const responseData = pm.response.json();",
                            "    pm.expect(responseData.code).to.equal(0);",
                            "});"
                        ]
                    }
                }
            ]
        }
    ]
} 